<!DOCTYPE html>
<html>

<head>
  <title>Progress Dashboard</title>
  <link rel="stylesheet" href="/static/style.css">

  <style>
    /* Add simple styles for JS rendered content */
    .day-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid var(--border);
    }

    .progress-bar {
      flex-grow: 1;
      margin: 0 16px;
      background: var(--bg-alt);
      height: 8px;
      border-radius: 4px;
      overflow: hidden;
    }

    .progress-fill {
      background: var(--green);
      height: 100%;
      transition: width 0.3s;
    }
  </style>
</head>

<body class="dashboard-page">

  <header class="topbar">
    <div class="logo">üß† Local LeetCode</div>
    <a href="/" class="nav-link">‚Üê Practice</a>
  </header>

  <div class="dashboard">

    <h1>üìä Progress Dashboard</h1>

    <div class="dashboard-grid">

      <div class="card stat-card">
        <h3>Overall Progress</h3>
        <div id="overall-percent" class="big">0%</div>
        <p id="overall-text">0 / 0 problems solved</p>

        <div class="progress-bar">
          <div id="overall-bar" class="progress-fill" style="width: 0%"></div>
        </div>
      </div>

      <div class="card stat-card">
        <h3>üî• Streaks</h3>
        <p><b>Current:</b> <span id="current-streak">0</span> days</p>
        <p><b>Best:</b> <span id="best-streak">0</span> days</p>
      </div>

    </div>

    <div class="card">
      <h2>üìÖ Day-wise Progress</h2>
      <div id="day-list">
        <!-- Rendered by JS -->
        <p class="muted">Loading stats...</p>
      </div>
    </div>

  </div>

  <script>
    // Configuration of problems (Hardcoded or ideally fetched, but for now we hardcode checking against known days/counts if possible, 
    // OR BETTER: we fetch the sidebar structure from "/" or just trust the solved list count against a total we know)

    // Actually, to get "Total" counts per day, we need the sidebar data. 
    // Since this is a static page now, let's fetch the sidebar structure from a JSON endpoint or parse it from the main page?
    // EASIER: In app.py, let's pass the 'sidebar' object to dashboard template as a JSON variable, 
    // even if we don't calculate stats server side.

    // For now, let's assume specific totals or just show total solved.
    // Wait, the user wants "UI processing".

    document.addEventListener("DOMContentLoaded", () => {
      const solved = JSON.parse(localStorage.getItem("solved_problems") || "[]");
      const solveLog = JSON.parse(localStorage.getItem("solve_log") || "{}");

      // --- Overall ---
      // We don't strictly know TOTAL problems in client unless we hardcode it or fetch it.
      // Let's guess/approximate or just show raw count.
      const totalProblems = 50; // Approx based on our config (8 days * ~5-8 probs)
      const percent = Math.round((solved.length / totalProblems) * 100);

      document.getElementById("overall-percent").innerText = `${percent}%`;
      document.getElementById("overall-text").innerText = `${solved.length} / ${totalProblems}+ problems solved`;
      document.getElementById("overall-bar").style.width = `${percent}%`;

      // --- Streak ---
      const dates = Object.keys(solveLog).sort();
      let streak = 0;
      let best = 0;
      let prev = null;

      dates.forEach(d => {
        if (prev) {
          const diff = (new Date(d) - new Date(prev)) / (1000 * 60 * 60 * 24);
          if (diff === 1) streak++;
          else if (diff > 1) streak = 1;
        } else {
          streak = 1;
        }
        if (streak > best) best = streak;
        prev = d;
      });

      // Check if current streak is active (today or yesterday)
      const today = new Date().toISOString().split('T')[0];
      const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];
      if (dates[dates.length - 1] !== today && dates[dates.length - 1] !== yesterday) {
        streak = 0;
      }

      document.getElementById("current-streak").innerText = streak;
      document.getElementById("best-streak").innerText = best;

      // --- Days ---
      const daysDiv = document.getElementById("day-list");
      daysDiv.innerHTML = "";

      // Simple visualization of recent activity instead of full curriculum breakdown
      // because we don't have the curriculum map in JS.
      if (dates.length === 0) {
        daysDiv.innerHTML = "<p>No activity yet.</p>";
      } else {
        // Show last 7 active days
        dates.slice(-7).reverse().forEach(date => {
          const count = solveLog[date];
          const row = document.createElement("div");
          row.className = "day-row";
          row.innerHTML = `
                    <span>${date}</span>
                    <span>${count} solved</span>
                `;
          daysDiv.appendChild(row);
        });
      }
    });
  </script>

</body>

</html>